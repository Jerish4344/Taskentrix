{% extends "base.html" %}
{% load core_tags %}

{% block title %}Respond to {{ form.title }}{% endblock %}
{% block page_title %}Submit Response{% endblock %}
{% block page_subtitle %}{{ form.title|truncatewords:8 }}{% endblock %}

{% block content %}
<div class="fade-in space-y-6">

    <!-- Back Link -->
    <a href="{% url 'form_detail' form.id %}" class="inline-flex items-center text-sm text-gray-500 hover:text-primary-600 font-medium transition">
        <i class="fas fa-arrow-left mr-2"></i> Back to Form
    </a>

    <div class="max-w-2xl mx-auto">
        <form method="post" class="space-y-6">
            {% csrf_token %}

            <!-- Form Header -->
            <div class="glass-card rounded-2xl p-5 lg:p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary-500 to-purple-500 flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-pen text-white text-lg"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-bold text-gray-800">{{ form.title }}</h2>
                        {% if form.description %}
                        <p class="text-sm text-gray-500 mt-0.5">{{ form.description }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Dynamic Fields -->
            <div class="glass-card rounded-2xl p-5 lg:p-6 space-y-5">
                {% for field in fields %}
                <div>
                    <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase tracking-wider">
                        {{ field.label }}
                        {% if field.required %}<span class="text-red-500">*</span>{% endif %}
                    </label>

                    {% if field.type == 'text' %}
                    <input type="text" name="field_{{ forloop.counter0 }}" {% if field.required %}required{% endif %}
                           placeholder="Enter {{ field.label|lower }}..."
                           class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">

                    {% elif field.type == 'number' %}
                    <input type="number" name="field_{{ forloop.counter0 }}" {% if field.required %}required{% endif %}
                           placeholder="0"
                           class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">

                    {% elif field.type == 'textarea' %}
                    <textarea name="field_{{ forloop.counter0 }}" rows="4" {% if field.required %}required{% endif %}
                              placeholder="Enter {{ field.label|lower }}..."
                              class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition resize-y"></textarea>

                    {% elif field.type == 'select' %}
                    <select name="field_{{ forloop.counter0 }}" {% if field.required %}required{% endif %}
                            class="w-full px-3 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">
                        <option value="">— Select —</option>
                        {% if field.options %}
                        {% for opt in field.options %}
                        <option value="{{ opt }}">{{ opt }}</option>
                        {% endfor %}
                        {% endif %}
                    </select>

                    {% elif field.type == 'checkbox' %}
                    <label class="flex items-center gap-2 p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-primary-50 transition">
                        <input type="checkbox" name="field_{{ forloop.counter0 }}" value="yes"
                               class="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500">
                        <span class="text-sm text-gray-700">{{ field.label }}</span>
                    </label>

                    {% elif field.type == 'date' %}
                    <input type="date" name="field_{{ forloop.counter0 }}" {% if field.required %}required{% endif %}
                           class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">

                    {% else %}
                    <input type="text" name="field_{{ forloop.counter0 }}" {% if field.required %}required{% endif %}
                           placeholder="Enter value..."
                           class="w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">
                    {% endif %}
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-400">
                    <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                    <p class="text-sm">This form has no fields configured.</p>
                </div>
                {% endfor %}
            </div>

            <!-- Submit -->
            {% if fields %}
            <div class="flex items-center justify-end gap-3">
                <a href="{% url 'form_detail' form.id %}" class="px-5 py-2.5 bg-gray-100 text-gray-700 text-sm font-semibold rounded-xl hover:bg-gray-200 transition">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-primary-600 to-purple-600 text-white text-sm font-semibold rounded-xl hover:shadow-lg hover:shadow-primary-500/25 transition-all hover:-translate-y-0.5">
                    <i class="fas fa-paper-plane mr-2"></i> Submit Response
                </button>
            </div>
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}
